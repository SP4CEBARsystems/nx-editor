<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>LowRes NX</title>
    <style>
    body {
      background-color: #000;
      margin: 0;
      padding: 0;
    }
    .emscripten_border {
    }
    .emscripten {
      display: block;
      margin: auto;
    }
    </style>
  </head>
  <body>
    <div class="emscripten_border">
      <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" onmousedown="window.focus()"></canvas>
    </div>

    <script type='text/javascript'>
      const params = new URLSearchParams(window.location.search);
      const p = params.get("p");
      console.log(p);

      const readFilesFromFS = () => {
        console.log(FS.root.contents);
        // const file = FS.readFile(`/blob:http:/127.0.0.1:5501/${'7b8a79d4-298b-48dc-9bf0-ea871449096c'}`);
        const file = FS.readFile(p.replace(/\/\//g, "/"));
        // const file = FS.readFile('/Gfx Designer 2.0.nx');
        console.log(file);
        console.log(file.map(uinteger=>String.fromCharCode(uinteger)));
        const decoder = new TextDecoder("utf-8");
        const text = decoder.decode(file);
        console.log(text); // Output: "'TITLE:  
      }

      setTimeout(readFilesFromFS, 5000);

      var Module = {
        canvas: document.getElementById('canvas'),
        arguments: [
          // "Gfx Designer 2.0.nx",
          // "Disk.nx",
          p,
        ],
        print: function(t) {
          console.log(t);
        },
        printErr: function(t) {
          console.log(t);
        }
      };
      function onKeyDown_blocker(event) {
        event = event || window.event;
        if (event.keyCode == 37 || event.keyCode == 38 || event.keyCode == 39 || event.keyCode == 40) {
          if (event.preventDefault) event.preventDefault();
        }
      }
      document.addEventListener('keydown', onKeyDown_blocker, false);
    </script>
    <script async type="text/javascript" src="LowResNX120.js"></script>
  </body>
</html>
