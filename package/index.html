<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>LowRes NX</title>
    <style>
    body {
      background-color: #000;
      margin: 0;
      padding: 0;
    }
    .emscripten_border {
    }
    .emscripten {
      display: block;
      margin: auto;
    }
    </style>
  </head>
  <body>
    <div class="emscripten_border">
      <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" onmousedown="window.focus()"></canvas>
    </div>

    <script type='text/javascript'>
      const params = new URLSearchParams(window.location.search);
      const p = params.get("p");

      var Module = {
        canvas: document.getElementById('canvas'),
        arguments: [p],
        print: function(t) {
          console.log(t);
        },
        printErr: function(t) {
          console.log(t);
        }
      };
      function onKeyDown_blocker(event) {
        event = event || window.event;
        if (event.keyCode == 37 || event.keyCode == 38 || event.keyCode == 39 || event.keyCode == 40) {
          if (event.preventDefault) event.preventDefault();
        }
      }
      document.addEventListener('keydown', onKeyDown_blocker, false);
      document.addEventListener('keydown', (e)=>console.log('keydown received:', e));
      document.addEventListener('keyup', (e)=>console.log('keyup received:', e));

    //   window.addEventListener('message', (e) => {
    //     const data = e.data;
    //     if (!data || !data.type) return;

    //     // Create synthetic KeyboardEvent
    //     const syntheticEvent = new KeyboardEvent(data.type, {
    //       key: data.key,
    //       code: data.code,
    //       keyCode: data.keyCode,
    //       charCode: data.charCode,
    //       which: data.which,
    //       altKey: data.altKey,
    //       ctrlKey: data.ctrlKey,
    //       shiftKey: data.shiftKey,
    //       metaKey: data.metaKey,
    //       repeat: data.repeat,
    //       location: data.location,
    //       bubbles: true,
    //       cancelable: true,
    //       composed: true
    //     });

    //     // Workaround: define legacy props (since constructor ignores them)
    //     Object.defineProperties(syntheticEvent, {
    //       keyCode: { get: () => data.keyCode },
    //       charCode: { get: () => data.charCode },
    //       which:   { get: () => data.which }
    //     });

    //     // Dispatch on body (or a focused element in iframe)
    //     const target = document.activeElement || document.body;
    //     target.dispatchEvent(syntheticEvent);
    // });

    </script>
    <script async type="text/javascript" src="LowResNX120.js"></script>
  </body>
</html>
